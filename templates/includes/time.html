
<button type="button" id="modalBtn" data-toggle="modal" data-target="#myModal">
</button>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Inactivity warning</h4>
      </div>
      <div class="modal-body">
        While inactive we will not be recording billable hours
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<script>

var idleTime = 0;
var modalBtn = document.getElementById('modalBtn')
var worktimer = 0;
var eventForm = document.getElementById('menuform');
var eventSubmit = document.getElementById('entryLogBtn')
var input = document.createElement('input');
var workTimerThreshold = 15; //seconds
var logOutThreshold = 20; //seconds
input.type = "hidden";


if ({{ inactive }}  == 1) {
    modalBtn.click()
    idleTime = idleTime + workTimerThreshold;
}

$(document).ready(function () {

    var timeInterval = setInterval(function () { checkModal(timerIncrement); }, 1000);

    $(this).mousemove( function (e) {
        checkModal(resetIdle);
    });

    $(this).keypress( function (e) {
        checkModal(resetIdle);
    });

    $(eventForm).on('submit', function () {
        input.name = "seconds"
        input.value = worktimer
        eventForm.appendChild(input)
    });



});

function checkModal( callback ) {
    var classes = document.getElementById('myModal').classList;
    var pause = 0;
    for (var i = 0; i < classes.length; i++){
        if (classes[i]  == "in") {
            var pause = 1
        }
    }
    callback(pause);
}

function resetIdle( pause ) {
    if (!pause){
        idleTime = 0;
    }
}

function timerIncrement( pause ) {
    console.log(idleTime);
    if (!pause){
        if (idleTime > workTimerThreshold) {
            eventSubmit.click()
        } else {
            worktimer = worktimer + 1;
        }
    }
    idleTime = idleTime + 1;
    if (idleTime > logOutThreshold) {
        //alert("Time to log out")
    }
}

</script>
